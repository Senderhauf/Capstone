{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getPrototypeOf = require(\"babel-runtime/core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _underscore = require(\"underscore\");\n\nvar _underscore2 = _interopRequireDefault(_underscore);\n\nvar _processor = require(\"./processor\");\n\nvar _processor2 = _interopRequireDefault(_processor);\n\nvar _index = require(\"../index\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _timeevent = require(\"../timeevent\");\n\nvar _timeevent2 = _interopRequireDefault(_timeevent);\n\nvar _indexedevent = require(\"../indexedevent\");\n\nvar _indexedevent2 = _interopRequireDefault(_indexedevent);\n\nvar _timerange = require(\"../timerange\");\n\nvar _timerange2 = _interopRequireDefault(_timerange);\n\nvar _timerangeevent = require(\"../timerangeevent\");\n\nvar _timerangeevent2 = _interopRequireDefault(_timerangeevent);\n\nvar _pipeline = require(\"../pipeline\");\n\nvar _util = require(\"../base/util\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction isSubclass(Base, X) {\n  return Base === X || X.prototype === Base;\n}\n/**\n *  Copyright (c) 2016-2017, The Regents of the University of California,\n *  through Lawrence Berkeley National Laboratory (subject to receipt\n *  of any required approvals from the U.S. Dept. of Energy).\n *  All rights reserved.\n *\n *  This source code is licensed under the BSD-style license found in the\n *  LICENSE file in the root directory of this source tree.\n */\n\n\nvar Converter = function (_Processor) {\n  (0, _inherits3.default)(Converter, _Processor);\n\n  function Converter(arg1, options) {\n    (0, _classCallCheck3.default)(this, Converter);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Converter.__proto__ || (0, _getPrototypeOf2.default)(Converter)).call(this, arg1, options));\n\n    if (arg1 instanceof Converter) {\n      var other = arg1;\n      _this._convertTo = other._convertTo;\n      _this._duration = other._duration;\n      _this._durationString = other._durationString;\n      _this._alignment = other._alignment;\n    } else if ((0, _pipeline.isPipeline)(arg1)) {\n      if (!_underscore2.default.has(options, \"type\")) {\n        throw new Error(\"Converter: constructor needs 'type' in options\");\n      }\n\n      if (isSubclass(_timeevent2.default, options.type)) {\n        _this._convertTo = options.type;\n      } else if (isSubclass(_timerangeevent2.default, options.type) || isSubclass(_indexedevent2.default, options.type)) {\n        _this._convertTo = options.type;\n\n        if (options.duration && _underscore2.default.isString(options.duration)) {\n          _this._duration = _util2.default.windowDuration(options.duration);\n          _this._durationString = options.duration;\n        }\n      } else {\n        throw Error(\"Unable to interpret type argument passed to Converter constructor\");\n      }\n\n      _this._alignment = options.alignment || \"center\";\n    } else {\n      throw new Error(\"Unknown arg to Converter constructor\", arg1);\n    }\n\n    return _this;\n  }\n\n  (0, _createClass3.default)(Converter, [{\n    key: \"clone\",\n    value: function clone() {\n      return new Converter(this);\n    }\n  }, {\n    key: \"convertEvent\",\n    value: function convertEvent(event) {\n      var T = this._convertTo;\n\n      if (isSubclass(_timeevent2.default, T)) {\n        return event;\n      } else if (isSubclass(_timerangeevent2.default, T)) {\n        var alignment = this._alignment;\n        var begin = void 0,\n            end = void 0;\n\n        if (!this._duration) {\n          throw new Error(\"Duration expected in converter\");\n        }\n\n        switch (alignment) {\n          case \"front\":\n            begin = event.timestamp();\n            end = new Date(+event.timestamp() + this._duration);\n            break;\n\n          case \"center\":\n            begin = new Date(+event.timestamp() - parseInt(this._duration / 2, 10));\n            end = new Date(+event.timestamp() + parseInt(this._duration / 2, 10));\n            break;\n\n          case \"behind\":\n            end = event.timestamp();\n            begin = new Date(+event.timestamp() - this._duration);\n            break;\n\n          default:\n            throw new Error(\"Unknown alignment of converter\");\n        }\n\n        var timeRange = new _timerange2.default([begin, end]);\n        return new T(timeRange, event.data());\n      } else if (isSubclass(_indexedevent2.default, T)) {\n        var timestamp = event.timestamp();\n\n        var indexString = _index2.default.getIndexString(this._durationString, timestamp);\n\n        return new this._convertTo(indexString, event.data(), null);\n      }\n    }\n  }, {\n    key: \"convertTimeRangeEvent\",\n    value: function convertTimeRangeEvent(event) {\n      var T = this._convertTo;\n\n      if (isSubclass(_timerangeevent2.default, T)) {\n        return event;\n      }\n\n      if (isSubclass(_timeevent2.default, T)) {\n        var alignment = this._alignment;\n        var beginTime = event.begin();\n        var endTime = event.end();\n        var timestamp = void 0;\n\n        switch (alignment) {\n          case \"lag\":\n            timestamp = beginTime;\n            break;\n\n          case \"center\":\n            timestamp = new Date(parseInt((beginTime.getTime() + endTime.getTime()) / 2, 10));\n            break;\n\n          case \"lead\":\n            timestamp = endTime;\n            break;\n        }\n\n        return new T(timestamp, event.data());\n      }\n\n      if (isSubclass(_indexedevent2.default, T)) {\n        throw new Error(\"Cannot convert TimeRangeEvent to an IndexedEvent\");\n      }\n    }\n  }, {\n    key: \"convertIndexedEvent\",\n    value: function convertIndexedEvent(event) {\n      var T = this._convertTo;\n\n      if (isSubclass(_indexedevent2.default, T)) {\n        return event;\n      }\n\n      if (isSubclass(_timeevent2.default, T)) {\n        var alignment = this._alignment;\n        var beginTime = event.begin();\n        var endTime = event.end();\n        var timestamp = void 0;\n\n        switch (alignment) {\n          case \"lag\":\n            timestamp = beginTime;\n            break;\n\n          case \"center\":\n            timestamp = new Date(parseInt((beginTime.getTime() + endTime.getTime()) / 2, 10));\n            break;\n\n          case \"lead\":\n            timestamp = endTime;\n            break;\n        }\n\n        return new T(timestamp, event.data());\n      }\n\n      if (isSubclass(_timerangeevent2.default, T)) {\n        return new T(event.timerange(), event.data());\n      }\n    }\n    /**\n     * Output a converted event\n     */\n\n  }, {\n    key: \"addEvent\",\n    value: function addEvent(event) {\n      if (this.hasObservers()) {\n        var outputEvent = void 0;\n\n        if (event instanceof _timerangeevent2.default) {\n          outputEvent = this.convertTimeRangeEvent(event);\n        } else if (event instanceof _indexedevent2.default) {\n          outputEvent = this.convertIndexedEvent(event);\n        } else if (event instanceof _timeevent2.default) {\n          outputEvent = this.convertEvent(event);\n        } else {\n          throw new Error(\"Unknown event type received\");\n        }\n\n        this.emit(outputEvent);\n      }\n    }\n  }]);\n  return Converter;\n}(_processor2.default);\n\nexports.default = Converter;","map":null,"metadata":{},"sourceType":"script"}